# ImtCore Repository Statistics

This directory contains tools and configuration for generating comprehensive repository statistics for the ImtCore (Imaging Tools Core) project.

## Overview

The repository statistics system provides both **quantity** and **quality** metrics about the ImtCore codebase:

### Quantity Metrics
- **Total Lines of Code**: Overall codebase size
- **Source Files**: Count of all C++ source and header files
- **Code Lines**: Lines containing actual code (excluding comments and blank lines)
- **Total Statements**: Count of executable statements/instructions in the code
- **Libraries**: Number of static libraries in `Include/` directory
- **Packages**: Number of component packages in `Impl/` directory
- **Classes**: Total number of C++ classes
- **Interfaces**: Count of interface classes (classes starting with `I`)
- **Components**: ImtCore framework components using `I_BEGIN_COMPONENT` macro
- **Functions/Methods**: Total count of functions and methods
- **Namespaces**: Number of unique namespaces used
- **Tests**: Number of test files
- **Documentation**: Count of documentation files

### Quality Metrics
- **Quality Score**: Composite score (0-100) based on various quality indicators
- **Comment-to-Code Ratio**: Ratio of comment lines to code lines (ideal: 0.2-0.5)
- **Average Lines per File**: Indicator of file maintainability
- **Average Lines per Class**: Complexity indicator for class design
- **Technical Debt Markers**:
  - TODO count: Items marked for future implementation
  - FIXME count: Known issues requiring fixes
  - HACK count: Temporary workarounds needing refactoring
- **Large Files**: Files exceeding 1000 lines (maintainability concern)

### SOLID Principles Compliance
- **SOLID Compliance Score**: Overall adherence to SOLID principles (0-100)
- **Single Responsibility Principle (SRP)**:
  - Large classes with >15 methods
  - Average methods per class
- **Open/Closed Principle (OCP)**:
  - Inheritance depth tracking
- **Liskov Substitution Principle (LSP)**:
  - Classes with deep inheritance (>4 levels)
- **Interface Segregation Principle (ISP)**:
  - Large interfaces with >10 methods
  - Average methods per interface
- **Dependency Inversion Principle (DIP)**:
  - Abstract vs concrete dependencies
  - Abstraction ratio

### Code Structure Metrics
- **Include Dependencies**: Number of files with tracked dependencies
- **File Size Distribution**: Histogram of file sizes
- **Namespace Usage**: Distribution of namespace usage
- **Export Macros**: Usage of ImtCore and ACF export macros

## Files

### Scripts

- **`generate_stats.py`**: Python script that analyzes the repository and generates `stats.json`
  - Scans all C++ source files (`.h`, `.cpp`, `.c`, `.hpp`, `.cc`)
  - Extracts classes, interfaces, components, functions, and namespaces
  - Counts lines, comments, blank lines, and statements
  - Identifies technical debt markers
  - Calculates quality metrics and SOLID compliance
  - Analyzes code structure and dependencies

- **`stats_template.html`**: HTML template for displaying statistics
  - Interactive, responsive design
  - Visual charts and progress bars
  - Quality score gauge
  - SOLID principles compliance section
  - Sortable libraries and packages lists

### Generated Files

- **`stats.json`**: Complete repository statistics in JSON format
  - Generated by `generate_stats.py`
  - Contains all metrics and detailed file information
  - Updated automatically by GitHub Actions

## Usage

### Local Generation

Generate statistics locally:

```bash
# From repository root
python3 scripts/generate_stats.py . stats.json

# View results
cat stats.json | python3 -m json.tool | less
```

### GitHub Actions

Statistics are automatically generated and deployed to GitHub Pages via the workflow `.github/workflows/stats-pages.yml`:

- **Trigger**: On push to `main`/`master`, manual dispatch, or weekly schedule
- **Output**: Available at `https://imagingtools.github.io/ImtCore/stats/`
- **Combined with**: Doxygen API documentation

### Viewing Statistics

Access the live statistics page:
- **Statistics**: https://imagingtools.github.io/ImtCore/stats/
- **API Documentation**: https://imagingtools.github.io/ImtCore/

## Quality Score Calculation

The quality score (0-100) is calculated based on:

1. **Base Score**: Starts at 100
2. **Technical Debt Penalty**: Deducts points based on TODO/FIXME/HACK density
   - TODOs: 1x weight
   - FIXMEs: 2x weight
   - HACKs: 3x weight
   - Maximum deduction: 20 points
3. **Comment Ratio Bonus/Penalty**:
   - Bonus +5: Comment ratio between 0.2-0.5 (ideal)
   - Penalty -10: Comment ratio below 0.1 (under-documented)
4. **Large Files Penalty**: Deducts 0.5 points per large file (>1000 lines)
   - Maximum deduction: 15 points

### Interpreting Quality Score

- **90-100**: Excellent - Well-maintained, documented code
- **75-89**: Good - Generally healthy codebase
- **60-74**: Moderate - Some areas need attention
- **Below 60**: Needs improvement - Consider refactoring efforts

## Customization

### Adjust Quality Thresholds

Edit `scripts/generate_stats.py`:

```python
# Large file threshold (default: 1000 lines)
large_file_threshold = 1000

# Ideal comment ratio range (default: 0.2-0.5)
if 0.2 <= comment_ratio <= 0.5:
    score += 5
```

### Add New Metrics

To add custom metrics:

1. Modify `generate_stats.py` to collect new data
2. Update `stats_template.html` to display the metric
3. Test locally before committing

### Update Schedule

Modify the cron schedule in `.github/workflows/stats-pages.yml`:

```yaml
schedule:
  # Run weekly on Monday at 00:00 UTC
  - cron: '0 0 * * 1'
```

## Technical Details

### Supported File Types

- `.h` - C++ header files (analyzed for classes, interfaces, components)
- `.cpp` - C++ implementation files
- `.c` - C source files
- `.hpp` - C++ header files (alternative extension)
- `.cc` - C++ source files (alternative extension)

### Line Counting

The script classifies lines into:
- **Code Lines**: Executable C++ statements
- **Comment Lines**: Single-line (`//`) and multi-line (`/* */`) comments
- **Blank Lines**: Empty lines

### Component Detection

Components are identified by the ImtCore framework macro:
```cpp
I_BEGIN_COMPONENT(ComponentName);
    // ... component structure
I_END_COMPONENT;
```

### Interface Detection

Interfaces are C++ classes starting with uppercase 'I' followed by another uppercase letter:
```cpp
class IMyInterface { ... };
```

## Maintenance

### Updating Statistics

Statistics are automatically updated when:
1. Code is pushed to `main`/`master` branch
2. Workflow is manually triggered via GitHub Actions
3. Weekly scheduled run (every Monday)

### Troubleshooting

If statistics seem incorrect:

1. **Check workflow logs**: GitHub Actions â†’ Documentation and Statistics workflow
2. **Verify file patterns**: Ensure new file types are included in extensions list
3. **Test locally**: Run `generate_stats.py` locally to debug
4. **Review exclusions**: Check if directories are being skipped

### Performance

- **Generation Time**: ~30-60 seconds for full repository scan
- **Output Size**: `stats.json` is typically 500KB-1MB
- **Page Load**: Statistics page loads in <1 second

## Contributing

When adding new statistics:

1. Ensure metrics provide actionable insights
2. Document the meaning and interpretation
3. Add visual representation in HTML template
4. Test with various codebase sizes
5. Update this README with new metrics

## References

- [GitHub Pages Documentation](https://docs.github.com/en/pages)
- [ImtCore Repository](https://github.com/ImagingTools/ImtCore)

## License

This statistics system is part of the ImtCore project.
