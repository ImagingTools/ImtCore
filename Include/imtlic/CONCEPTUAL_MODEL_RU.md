# Модуль ImtLic - Концептуальная модель и документация

## Обзор

Модуль `imtlic` реализует комплексную систему лицензирования для программных и аппаратных продуктов. Этот документ объясняет концептуальную модель и взаимосвязи между основными абстракциями.

## Основные концепции

### 1. Продукт (Product - IProductInfo, CProductInfo)

**Продукт** представляет собой программное или аппаратное предложение компании. Продукты фундаментально определяются как коллекции **Функций (Features)**.

**Ключевые свойства:**
- Уникальный ID продукта
- Понятное имя и описание
- Классификация по категориям
- Коллекция Функций, определяющих возможности

**Концептуальная роль:**
- Контейнер Функций
- Через лицензии также является контейнером Определений лицензий
- Часть потенциальной иерархии семейства продуктов

### 2. Функция (Feature - IFeatureInfo, CFeatureInfo)

**Функция** представляет собой отдельную возможность или функциональность в рамках продукта. Функции являются атомарными единицами, определяющими, что может делать продукт.

**Ключевые свойства:**
- Уникальный ID функции
- Понятное имя и описание
- Флаг опциональности vs обязательности
- Флаг разрешения (для контроля доступа)
- Зависимости от других функций
- Иерархические отношения родитель-потомок

**Концептуальная роль:**
- Атомарная единица функциональности продукта
- Могут быть организованы иерархически (деревья функций)
- "Разблокируются" через лицензии

**Важные различия:**
- **Опциональные функции** - это функциональность, которая может продаваться опционально. Они НЕ обязательны для базовой функциональности продукта и могут приобретаться отдельно клиентами в зависимости от их потребностей.
- **Функции-разрешения** - это НЕ продаваемые функции. Они представляют права контроля доступа или операционные разрешения в рамках приложения, а не возможности продукта. Пример: разрешение "Close" (Закрыть) контролирует возможность завершения работы приложения, что является операционным правом, а не продаваемой функцией продукта.

### 3. Определение лицензии (License Definition - ILicenseDefinition, CLicenseDefinition)

**Определение лицензии** представляет тип лицензии, которую можно приобрести. По сути, это **контейнер Функций** - оно определяет, какие функции будут разблокированы при активации этой лицензии.

**Ключевые свойства:**
- Уникальный ID лицензии
- Понятное имя и описание
- Связанный ID продукта
- Список Функций, которые она разблокирует
- Зависимости от других лицензий

**Концептуальная роль:**
- Определяет, что получает клиент при покупке этой лицензии
- Связывает покупки с доступностью функций
- Может требовать другие лицензии в качестве предварительных условий

**Ключевая идея:**
```
Продукт → содержит Определения лицензий → содержат Функции
Следовательно: Продукт → содержит Функции
```

### 4. Экземпляр продукта (Product Instance - IProductInstanceInfo, CProductInstanceInfo)

**Экземпляр продукта** создается, когда продукт продан, установлен или развернут у клиента. Он представляет конкретную установку продукта.

**Ключевые свойства:**
- Уникальный ID экземпляра (например, MAC-адрес, ID оборудования)
- Связь с определением продукта (ID продукта)
- Информация о клиенте (ID клиента)
- Серийный номер и привязка к проекту
- Коллекция активированных Экземпляров лицензий
- Статус использования и флаги

**Концептуальная роль:**
- Представляет конкретную установку продукта
- Управляет активированными лицензиями
- Предоставляет доступ к доступным лицензиям для этой установки
- Связывает определения продуктов с фактическими развертываниями

### 5. Экземпляр лицензии (License Instance - ILicenseInstance, CLicenseInstance)

**Экземпляр лицензии** - это активированная лицензия на основе Определения лицензии. Когда клиент приобретает лицензию, она становится Экземпляром лицензии в его Экземпляре продукта.

**Ключевые свойства:**
- Наследует все свойства от Определения лицензии
- Дата/время истечения срока действия (или бессрочная)
- Данные активации, специфичные для экземпляра

**Концептуальная роль:**
- Представляет фактически активированную лицензию (а не просто тип лицензии)
- Добавляет временную информацию к определениям лицензий
- Управляется в рамках Экземпляра продукта

### 6. Информация о лицензировании продукта (Product Licensing Info - IProductLicensingInfo, CProductLicensingInfo)

**Информация о лицензировании продукта** предоставляет доступ ко всем доступным Определениям лицензий для конкретного продукта. Служит полным каталогом лицензирования.

**Ключевые свойства:**
- Коллекция всех Определений лицензий для продукта
- Идентификация продукта

**Концептуальная роль:**
- Полный каталог вариантов лицензирования для продукта
- Используется для просмотра доступных типов лицензий
- Источник для активации лицензий

## Типичный рабочий процесс

1. **Фаза определения продукта:**
   - Определить Продукт с его Функциями
   - Создать Определения лицензий, указывающие, какие Функции разблокирует каждая лицензия
   - Установить зависимости между функциями и лицензиями

2. **Фаза продажи/развертывания:**
   - Клиент приобретает конкретные лицензии
   - Создается Экземпляр продукта для установки
   - Активируются Экземпляры лицензий на основе покупок

3. **Фаза выполнения/валидации:**
   - Система проверяет доступные функции на основе активных Экземпляров лицензий
   - Доступность функций определяет возможности приложения
   - Проверяются даты истечения срока действия для лицензий с ограниченным сроком

## Вспомогательные интерфейсы

### Интерфейсы-провайдеры

- **IFeatureInfoProvider**: Предоставляет доступ к каталогам функций
- **ILicenseInfoProvider**: Предоставляет доступ к каталогам определений лицензий
- **ILicenseInstanceProvider**: Предоставляет доступ к активированным лицензиям
- **IProductInstanceInfoProvider**: Предоставляет доступ ко всем экземплярам продуктов

### Интерфейсы для аппаратного обеспечения

- **IHardwareInstanceInfo**: Представляет экземпляры аппаратных продуктов
- **ILicensedHardwareInstanceInfo**: Аппаратные экземпляры, связанные с лицензированием ПО

### Валидация и управление

- **ILicenseStatus**: Статус валидации лицензии и информация об истечении срока
- **ILicenseController**: Управляет импортом и валидацией файлов лицензий

## Диаграмма взаимосвязей

```
Продукт (Product)
  ├── Содержит: Функции (Features) (1:N)
  └── Через: Определения лицензий (License Definitions) (1:N)
       └── Разблокируют: Функции (Features) (N:M)

Экземпляр продукта (Product Instance) (создается при продаже продукта)
  ├── Ссылается на: Продукт (Product) (N:1)
  ├── Ссылается на: Клиента (Customer) (N:1)
  └── Содержит: Экземпляры лицензий (License Instances) (1:N)
       └── На основе: Определения лицензии (License Definition) (N:1)
            └── Разблокирует: Функции (Features) (N:M)

Экземпляр лицензии (License Instance) расширяет Определение лицензии (License Definition)
  └── Добавляет: Дату истечения срока действия
```

## Ключевые принципы проектирования

1. **Разделение ответственности:**
   - Определения продуктов отделены от экземпляров продуктов
   - Определения лицензий отделены от экземпляров лицензий
   - Функции являются независимыми единицами

2. **Паттерн контейнера:**
   - Продукты содержат Функции
   - Определения лицензий содержат Функции
   - Экземпляры продуктов содержат Экземпляры лицензий

3. **Гибкость:**
   - Функции могут быть иерархическими
   - Лицензии могут зависеть от других лицензий
   - Функции могут зависеть от других функций

4. **Временной контроль:**
   - Экземпляры лицензий могут иметь даты истечения срока
   - Льготные периоды позволяют предоставить отсрочку после истечения срока

## Примечания по реализации

Все интерфейсы следуют паттернам ACF (Application Component Framework):
- Виртуальное наследование для композиции интерфейсов
- Typedef'ы умных указателей (Unique/Shared)
- Поддержка сериализации через IArchive
- Отслеживание изменений через IChangeable
- Мета-информация через константы enum

## Улучшения документации

Это обновление документации включает:
- Комплексную документацию пространства имен в `imtlic.h`
- Детальную документацию интерфейсов для всех основных концепций
- Улучшенную документацию методов с описанием параметров
- Перекрестные ссылки между связанными интерфейсами
- Уточнение концептуальной модели во всех компонентах
- Явное выделение различий между опциональными функциями и функциями-разрешениями

---

**Примечание:** Этот документ синхронизирован с англоязычной версией (CONCEPTUAL_MODEL.md) и немецкой версией (DOKUMENTATION_ZUSAMMENFASSUNG.md). При внесении изменений в одну версию необходимо обновить все языковые версии.
