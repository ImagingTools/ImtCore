version: '3.8'

# Docker Compose configuration for ImtCore test environment (Windows)
# 
# This provides the base infrastructure for running tests on Windows.
# Application-specific tests, resources, and startup scripts should be copied
# from the application repository (e.g., Lisa) when running the container.
#
# Note: This requires Docker Desktop on Windows with Windows containers enabled
#
# Usage from application repository (e.g., Lisa):
# 1. Build this Docker image from ImtCore
# 2. Run container and copy your tests, resources, and startup scripts
# 3. Execute your test suite

services:
  # Base test environment (Windows)
  tests:
    image: imtcore-tests:windows
    build:
      context: ../..
      dockerfile: Tests/Docker/Dockerfile.windows
    platform: windows/amd64
    volumes:
      # Mount test results to host for review
      - type: bind
        source: ./test-results
        target: C:/app/tests/test-results
    environment:
      # Application URL - should be set by the application repository
      - BASE_URL=${BASE_URL:-http://host.docker.internal:3000}
      - CI=true
      
      # PostgreSQL settings
      - START_POSTGRESQL=${START_POSTGRESQL:-false}
      - POSTGRES_DB=${POSTGRES_DB:-}
      - DATABASE_URL=${DATABASE_URL:-}
      
      # Custom application environment variables
      # These should be set by the application repository
      - TEST_USERNAME=${TEST_USERNAME:-}
      - TEST_PASSWORD=${TEST_PASSWORD:-}

  # Example: Separate PostgreSQL service (alternative to START_POSTGRESQL)
  # Uncomment if you prefer a separate database container
  # postgres:
  #   image: postgres:15
  #   platform: windows/amd64
  #   environment:
  #     - POSTGRES_PASSWORD=testpassword
  #     - POSTGRES_DB=test_db
  #   ports:
  #     - "5432:5432"

# Note: Windows containers may require additional configuration
# for networking. Consult Docker documentation for Windows containers.
